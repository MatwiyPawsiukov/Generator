<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Schneller Zufallszahlengenerator</title>
  <style>
    :root{
      --bg:#0f1724;
      --card:#0b1220;
      --accent:#60a5fa;
      --muted:#9aa7bf;
      --good:#10b981;
      --bad:#ef4444;
      --green:#10b981;
    }
    *{box-sizing:border-box}
    body{
      font-family:Inter,Segoe UI,system-ui,Arial;
      background:linear-gradient(180deg,var(--bg),#071028);
      color:#e6eef8;
      min-height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:24px;
      position:relative;
    }
    .card{
      width:920px;
      max-width:100%;
      background:rgba(255,255,255,0.03);
      border-radius:12px;
      padding:20px;
      box-shadow:0 8px 30px rgba(2,6,23,0.6);
    }
    h1{margin:0 0 8px;font-size:20px}
    .row{display:flex;gap:12px;align-items:center;margin-bottom:12px}
    label{font-size:13px;color:var(--muted)}
    input[type=number], input[type=range], button, select{
      background:transparent;
      color:inherit;
      border:1px solid rgba(255,255,255,0.06);
      padding:8px;
      border-radius:8px;
    }
    input[type=number]{width:120px}
    button{cursor:pointer}
    .big{
      font-size:48px;
      font-weight:700;
      letter-spacing:1px;
      text-align:center;
      padding:18px;
      border-radius:10px;
      background:linear-gradient(90deg,rgba(255,255,255,0.03),rgba(255,255,255,0.01));
      margin:8px 0;
    }
    .meta{display:flex;justify-content:space-between;gap:12px;flex-wrap:wrap}
    .meta div{font-size:13px;color:var(--muted)}
    .controls{display:flex;gap:8px;flex-wrap:wrap}
    .log{max-height:160px;overflow:auto;background:rgba(0,0,0,0.2);padding:8px;border-radius:8px;font-family:monospace;font-size:13px}
    .found{color:var(--good);font-weight:700}
    .warning{color:var(--bad)}
    .small{font-size:12px;color:var(--muted)}
    footer{margin-top:12px;font-size:12px;color:var(--muted)}
    .status-btn{
      width:16px;
      height:16px;
      border-radius:50%;
      display:inline-block;
      background-color:var(--bad);
      margin-left:4px;
    }
    .status-btn.running{background-color:var(--green);}
    /* Круг із галочкою */
    .hit-circle{
      position:fixed;
      right:30px;
      top:50%;
      transform:translateY(-50%);
      width:120px;
      height:120px;
      border-radius:50%;
      background-color:var(--green);
      display:flex;
      align-items:center;
      justify-content:center;
      font-size:60px;
      color:#0f1724;
      font-weight:bold;
      opacity:0;
      pointer-events:none;
      transition:opacity 0.3s ease;
      z-index:1000;
    }
    .hit-circle.show{
      opacity:1;
    }
    .audio-control{
      display:flex;
      align-items:center;
      gap:6px;
      font-size:12px;
      margin-left:12px;
    }
  </style>
</head>
<body>
  <div class="card">
    <h1>Schneller Zufallszahlengenerator</h1>
    <div class="row">
      <div>
        <label>Minimum</label><br>
        <input id="min" type="number" value="0" />
      </div>
      <div>
        <label>Maximum</label><br>
        <input id="max" type="number" value="1000" />
      </div>
      <div>
        <label>Zielzahl (stoppt, wenn getroffen)</label><br>
        <input id="target" type="number" placeholder="z.B. 43" />
      </div>
      <div style="min-width:180px">
        <label>Geschwindigkeit (ms — Intervall, 0 = maximal schnell)</label><br>
        <input id="speed" type="range" min="0" max="1000" value="16" />
        <div class="small">Aktuelle Geschwindigkeit: <span id="speedValue">16</span> ms</div>
      </div>
    </div>

    <div class="row controls">
      <button id="startBtn">Start</button>
      <button id="stopBtn" disabled>Stopp</button>
      <button id="resetBtn">Zurücksetzen</button>
      <label style="display:flex;align-items:center;gap:8px"><input id="stopOnMatch" type="checkbox" checked /> Anhalten bei Treffer</label>
      <label style="display:flex;align-items:center;gap:8px"><input id="useRAF" type="checkbox" /> requestAnimationFrame bei Geschwindigkeit = 0 nutzen</label>
      <div class="audio-control">
        <input type="checkbox" id="soundToggle" checked /> Ton bei Treffer
      </div>
    </div>

    <div class="big" id="display">—</div>

    <div class="meta">
      <div>Iterationen: <span id="count">0</span></div>
      <div>Letzter Treffer: <span id="lastMatch">—</span></div>
      <div>Status: <span id="status" class="small">Gestoppt</span><span class="status-btn" id="statusBtn"></span></div>
      <div>Letzte Zahl: <span id="last" class="small">—</span></div>
      <div>Durchschnittliche Iterationen pro Treffer: <span id="avg">—</span></div>
      <div>Gesamttreffer: <span id="totalHits">0</span></div>
      <div>Timer: <span id="timer">0s</span></div>
      <div>Gesamtiterationen: <span id="totalIter">0</span></div>
    </div>

    <h3 style="margin-top:12px">Protokoll (letzte 100)</h3>
    <div class="log" id="log"></div>

    <footer>
      Tipp: Für maximale Geschwindigkeit Geschwindigkeit auf 0 stellen und RAF aktivieren. Die UI aktualisiert sich mit der Bildwiederholrate des Browsers.
    </footer>
  </div>

  <!-- Круг із галочкою -->
  <div class="hit-circle" id="hitCircle">✔</div>
  <!-- Звуковий ефект -->
  <audio id="hitSound">
    <source src="./yamete-kudasai_gxXaCWn.mp3" type="audio/mpeg">
  </audio>

<script>
(() => {
  const minInput = document.getElementById('min')
  const maxInput = document.getElementById('max')
  const targetInput = document.getElementById('target')
  const speedInput = document.getElementById('speed')
  const speedValue = document.getElementById('speedValue')
  const startBtn = document.getElementById('startBtn')
  const stopBtn = document.getElementById('stopBtn')
  const resetBtn = document.getElementById('resetBtn')
  const stopOnMatch = document.getElementById('stopOnMatch')
  const useRAF = document.getElementById('useRAF')
  const soundToggle = document.getElementById('soundToggle')

  const display = document.getElementById('display')
  const countEl = document.getElementById('count')
  const lastEl = document.getElementById('last')
  const statusEl = document.getElementById('status')
  const lastMatchEl = document.getElementById('lastMatch')
  const logEl = document.getElementById('log')
  const avgEl = document.getElementById('avg')
  const totalHitsEl = document.getElementById('totalHits')
  const statusBtn = document.getElementById('statusBtn')
  const timerEl = document.getElementById('timer')
  const totalIterEl = document.getElementById('totalIter')
  const hitCircle = document.getElementById('hitCircle')
  const hitSound = document.getElementById('hitSound')

  let running = false
  let intervalId = null
  let rafId = null
  let iterations = 0
  let lastMatch = null
  let totalMatches = 0
  let totalIterationsForMatches = 0
  let sessionTotalIterations = 0
  let elapsedSeconds = 0
  let timerInterval = null
  const MAX_LOG = 100

  function randInt(min, max) {
    min = Math.ceil(min)
    max = Math.floor(max)
    return Math.floor(Math.random() * (max - min + 1)) + min
  }

  function log(msg, cls) {
    const line = document.createElement('div')
    if(cls) line.className = cls
    line.textContent = msg
    logEl.prepend(line)
    while(logEl.childElementCount > MAX_LOG) logEl.removeChild(logEl.lastChild)
  }

  function validateRange() {
    const min = Number(minInput.value)
    const max = Number(maxInput.value)
    if(Number.isNaN(min) || Number.isNaN(max)) return {ok:false,reason:'ungültig'}
    if(min > max) return {ok:false,reason:'min>max'}
    return {ok:true,min,max}
  }

  function showHitCircle() {
    hitCircle.classList.add('show')
    if(soundToggle.checked) hitSound.play()
    setTimeout(() => hitCircle.classList.remove('show'), 1000)
  }

  function updateUI(current) {
    display.textContent = current
    countEl.textContent = iterations
    lastEl.textContent = current
    statusEl.textContent = running ? 'Läuft' : 'Gestoppt'
    statusBtn.classList.toggle('running', running)
    if(lastMatch !== null) lastMatchEl.innerHTML = '<span class="found">'+lastMatch+'</span>'
    avgEl.textContent = totalMatches > 0 ? (totalIterationsForMatches / totalMatches).toFixed(2) : '—'
    totalHitsEl.textContent = totalMatches
    totalIterEl.textContent = sessionTotalIterations
    timerEl.textContent = elapsedSeconds + 's'
  }

  function tickOnce() {
    const vr = validateRange()
    if(!vr.ok) {
      statusEl.textContent = 'Ungültiger Bereich'
      statusEl.classList.add('warning')
      return false
    }
    const n = randInt(vr.min, vr.max)
    iterations++
    sessionTotalIterations++
    updateUI(n)
    const t = targetInput.value === '' ? null : Number(targetInput.value)
    log(`[${iterations}] ${n}` + (t !== null ? ` (Ziel ${t})` : ''))
    if(t !== null && n === t) {
      lastMatch = n
      totalMatches++
      totalIterationsForMatches += iterations
      log(`>>> TREFFER! Zahl ${n} gefunden nach ${iterations} Iterationen.`, 'found')
      showHitCircle()
      updateUI(n)
      if(stopOnMatch.checked) stop()
      iterations = 0
      return true
    }
    return false
  }

  function startTimer() {
    if(timerInterval) clearInterval(timerInterval)
    timerInterval = setInterval(() => {
      if(running) {
        elapsedSeconds++
        updateUI(lastEl.textContent)
      }
    }, 1000)
  }

  function start() {
    if(running) return
    const vr = validateRange()
    if(!vr.ok) { alert('Bitte Minimum und Maximum prüfen — Minimum muss <= Maximum sein.'); return }
    running = true
    startBtn.disabled = true
    stopBtn.disabled = false
    startTimer()

    const speed = Number(speedInput.value)
    if(speed === 0 && useRAF.checked) {
      function rafLoop() {
        if(!running) return
        tickOnce()
        rafId = requestAnimationFrame(rafLoop)
      }
      rafId = requestAnimationFrame(rafLoop)
    } else {
      intervalId = setInterval(() => {
        tickOnce()
      }, Math.max(0, Number(speedInput.value)))
    }
    updateUI(lastEl.textContent)
  }

  function stop() {
    running = false
    startBtn.disabled = false
    stopBtn.disabled = true
    if(intervalId) { clearInterval(intervalId); intervalId = null }
    if(rafId) { cancelAnimationFrame(rafId); rafId = null }
    updateUI(lastEl.textContent)
  }

  function reset() {
    stop()
    iterations = 0
    lastMatch = null
    totalMatches = 0
    totalIterationsForMatches = 0
    sessionTotalIterations = 0
    elapsedSeconds = 0
    display.textContent = '—'
    countEl.textContent = '0'
    lastMatchEl.textContent = '—'
    lastEl.textContent = '—'
    avgEl.textContent = '—'
    totalHitsEl.textContent = '0'
    totalIterEl.textContent = '0'
    timerEl.textContent = '0s'
    logEl.textContent = ''
  }

  speedInput.addEventListener('input', () => { speedValue.textContent = speedInput.value })
  startBtn.addEventListener('click', start)
  stopBtn.addEventListener('click', stop)
  resetBtn.addEventListener('click', reset)

  window.addEventListener('keydown', (e) => {
    if(e.code === 'Space') { e.preventDefault(); running ? stop() : start() }
    if(e.key.toLowerCase() === 'r') { reset() }
  })

})();
</script>
</body>
</html>
